"use strict";exports.__esModule=!0;var mongodb=require("mongodb"),config_1=require("../config"),MongoClient=mongodb.MongoClient,Mongo=function(){function t(){var t=this;this.db=null,MongoClient.connect(config_1.config.mongoStore.url,function(o,e){if(o)throw o;t.db=e,console.log("mongo front - connected!")})}return t.prototype.start=function(t){var o=this;this.db?t():setTimeout(function(){o.start(t)},300)},t.prototype.getCategories=function(){return this.db.collection("categories").find({}).sort({count:-1}).toArray()},t.prototype.getCategoriesByListIDs=function(t){void 0===t&&(t=[]);var o=t.map(function(t){return new mongodb.ObjectID(t)});return this.db.collection("categories").find({_id:{$in:o}}).sort({count:-1}).toArray()},t.prototype.getCategoryByID=function(t){return this.db.collection("categories").findOne({_id:new mongodb.ObjectID(t)})},t.prototype.getAllProductsByCategoryID=function(t){return this.db.collection("products").find({category:t,isShow:!0}).sort({name:1}).toArray()},t.prototype.getAllProductsBySearchRequest=function(t){return this.db.collection("products").find({name:{$regex:new RegExp(t,"i")},isShow:!0}).sort({name:1}).toArray()},t.prototype.getProductByID=function(t){return this.db.collection("products").findOne({_id:new mongodb.ObjectID(t)})},t.prototype.getProductsByListIDs=function(t){var o=t.map(function(t){return new mongodb.ObjectID(t)});return this.db.collection("products").find({_id:{$in:o}}).sort({name:1}).toArray()},t.prototype.getAllProductsByRecom=function(){return this.db.collection("products").find({isRecommended:!0,isShow:!0}).sort({name:1}).toArray()},t.prototype.addOrder=function(t){return this.db.collection("orders").insertOne(t)},t.prototype.getOrdersByUser=function(t){return this.db.collection("orders").find({"user.username":t},{_id:!0,orderNumber:!0,time:!0,sum:!0}).sort({orderNumber:-1}).toArray()},t.prototype.getOrderById=function(t){return this.db.collection("orders").find({_id:new mongodb.ObjectID(t)},{order:!0,_id:!1}).toArray()},t.prototype.getOrdersCountNext=function(){return this.db.collection("counter").findOneAndUpdate({orders:"orders"},{$inc:{count:1}},{upsert:!0})},t.prototype.getPortals=function(){return this.db.collection("portals").find({}).sort({count:-1}).toArray()},t.prototype.getPortalByID=function(t){return this.db.collection("portals").findOne({_id:new mongodb.ObjectID(t)})},t.prototype.getDelivery=function(){return this.db.collection("pages").findOne({name:"delivery"})},t.prototype.getAbout=function(){return this.db.collection("pages").findOne({name:"about"})},t.prototype.getContact=function(){return this.db.collection("pages").findOne({name:"contact"})},t.prototype.getGreet=function(){return this.db.collection("pages").findOne({name:"greet"})},t.prototype.getNews=function(){return this.db.collection("news").find({}).toArray()},t.prototype.getUserByID=function(t){return this.db.collection("users").findOne({_id:new mongodb.ObjectID(t)})},t.prototype.getUserByName=function(t){return this.db.collection("users").findOne({username:t})},t.prototype.addUser=function(t){return this.db.collection("users").insertOne(t)},t.prototype.updateUser=function(t,o){return this.db.collection("users").updateOne({_id:new mongodb.ObjectID(t)},{$set:o})},t.prototype.getBanners=function(){return this.db.collection("banners").find({}).sort({count:-1}).toArray()},t.prototype.addDebugInfo=function(t){return this.db.collection("debug").insertOne(t)},t.prototype.addMailResult=function(t){return this.db.collection("mails").insertOne(t)},t.prototype.recoveryPassword=function(t){return this.db.collection("users").findOne({email:t})},t.prototype.getIPsByDay=function(t){return this.db.collection("ips").findOne({day:t})},t.prototype.addIP=function(t){return this.db.collection("ips").insertOne(t)},t.prototype.pushIP=function(t){return this.db.collection("ips").findOneAndUpdate({day:t.day},{$push:{ips:t.ips[0]}},{upsert:!0})},t}(),db=new Mongo;exports.db=db;